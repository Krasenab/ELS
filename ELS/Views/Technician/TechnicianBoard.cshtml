@model TechnicianBoardViewModel;
@{
    ViewData["Title"] = "Technician Dashboard";
    Layout = "_Layout";
}

<main class="flex-grow bg-gray-50 font-sans antialiased p-6">
    <div class="max-w-7xl mx-auto space-y-10">

        <!-- Header -->
        <header class="flex flex-col sm:flex-row items-start sm:items-center justify-between">
            <h1 class="text-3xl font-extrabold text-gray-900 flex items-center space-x-2">
                <i class="fas fa-tachometer-alt text-sky-600"></i>
                <span>Technician Dashboard</span>
            </h1>
            <p class="mt-2 sm:mt-0 text-gray-700">Welcome back, @User.Identity.Name!</p>
        </header>

        <!-- Stats Cards -->
        <section class="grid grid-cols-1 sm:grid-cols-3 gap-6">
            <div class="bg-white rounded-2xl shadow-lg p-6 flex items-center space-x-4">
                <div class="p-4 bg-green-100 rounded-full">
                    <i class="fas fa-folder-open text-green-600 text-2xl"></i>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-500 uppercase">Open Tickets</p>
                    <p class="text-3xl font-bold text-gray-900">@Model.TotalOpen</p>
                </div>
            </div>
            <div class="bg-white rounded-2xl shadow-lg p-6 flex items-center space-x-4">
                <div class="p-4 bg-yellow-100 rounded-full">
                    <i class="fas fa-spinner text-yellow-600 text-2xl"></i>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-500 uppercase">In Progress</p>
                    <p class="text-3xl font-bold text-gray-900">@Model.TotalInProgress</p>
                </div>
            </div>
            <div class="bg-white rounded-2xl shadow-lg p-6 flex items-center space-x-4">
                <div class="p-4 bg-red-100 rounded-full">
                    <i class="fas fa-check-circle text-red-600 text-2xl"></i>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-500 uppercase">Closed Tickets</p>
                    <p class="text-3xl font-bold text-gray-900">@Model.TotalClosed</p>
                </div>
            </div>
        </section>

        <!-- My Tickets Table -->
        <section class="bg-white rounded-2xl shadow-lg p-6">
            <div class="flex flex-col sm:flex-row justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-gray-800">My Assigned Tickets</h2>
                <input id="ticketSearch" type="search" placeholder="Search tickets..."
                       class="mt-2 sm:mt-0 px-4 py-2 border border-gray-300 rounded-full bg-gray-100 text-gray-700
                      focus:outline-none focus:ring-2 focus:ring-sky-300 transition w-full sm:w-64" />
            </div>

            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Title</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Equipment</th>
                            <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase">Status</th>
                            <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase">Priority</th>
                            <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Actions</th>
                        </tr>
                    </thead>

                    <tbody class="bg-white divide-y divide-gray-200" id="ticketsTableBody">
                        @foreach (var t in Model.TechnicianTikets)
                        {
                            var st = t.Status ?? "";
                            var (bg, txt) = st switch
                            {
                                "Open" => ("bg-green-100", "text-green-800"),
                                "In Progress" => ("bg-yellow-100", "text-yellow-800"),
                                "Closed" => ("bg-red-100", "text-red-800"),
                                _ => ("bg-gray-100", "text-gray-800")
                            };

                            <tr data-title="@t.Title.ToLower()" class="hover:bg-gray-50 transition">
                                <td class="px-4 py-3 text-sm text-gray-900">@t.Title</td>
                                <td class="px-4 py-3 text-sm text-gray-700">@t.EquipmentName</td>
                                <td class="px-4 py-3 text-center">
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full @bg @txt">@st</span>
                                </td>
                                <td class="px-4 py-3 text-center text-sm text-gray-700">@t.Priority</td>

                                <!-- ACTIONS -->
                                <td class="px-4 py-3">
                                    <div class="flex justify-end items-center gap-2">
                                        <!-- Create Report (primary) -->
                                        <a asp-controller="Report" asp-action="CreateReport" asp-route-ticketId="@t.Id"
                                           class="inline-flex items-center gap-1.5 rounded-full h-9 px-4 text-xs sm:text-sm font-semibold
                                              bg-sky-600 text-white shadow hover:bg-sky-700 transition">
                                            <i class="fas fa-file-circle-plus"></i>
                                            Create Report
                                        </a>

                                        <!-- View (secondary / outline) -->
                                        <a asp-controller="Ticket" asp-action="MyTicketDetails" asp-route-id="@t.Id"
                                           class="inline-flex items-center gap-1.5 rounded-full h-9 px-4 text-xs sm:text-sm font-semibold
                                              bg-white text-gray-900 ring-1 ring-gray-300 hover:bg-gray-50 transition">
                                            <i class="fas fa-eye"></i>
                                            View
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        }

                        @if (!Model.TechnicianTikets.Any())
                        {
                            <tr>
                                <td colspan="5" class="px-4 py-6 text-center text-gray-500">
                                    No tickets assigned to you.
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Recent Reports -->
        <section class="bg-white rounded-2xl shadow-2xl p-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-800">
                    <i class="fas fa-file-alt text-indigo-500 mr-2"></i>
                    Recent Reports
                </h2>
                <a asp-controller="Reports" asp-action="Index" class="text-sm text-sky-600 hover:underline">
                    View all →
                </a>
            </div>
            @if (Model.Reports.Any())
            {
                <ul class="divide-y divide-gray-200">
                    @foreach (var r in Model.Reports)
                    {
                        <li class="flex items-center justify-between py-3">
                            <div class="space-y-1">
                                <p class="font-medium text-gray-900">@r</p>
                                <p class="text-sm text-gray-600">Created: @r</p>
                            </div>
                            <a href="@r"
                               class="inline-flex items-center px-3 py-1 bg-indigo-500 text-white text-xs font-medium rounded-md shadow
                                hover:bg-indigo-600 transition">
                                <i class="fas fa-download mr-1"></i> Download
                            </a>
                        </li>
                    }
                </ul>
            }
            else
            {
                <p class="text-center text-gray-500 py-8">
                    No reports available.
                </p>
            }
        </section>

    </div>
</main>

@section Scripts {
    <script>
       

    </script>
}
